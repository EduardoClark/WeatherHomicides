{
    "contents" : "################################################\n## Author: Eduardo Clark\n## Title: Homicides and temperature in Mexico\n## Date: January 2015\n##############################################\n\n##Join Homicide and Weather Data\nHomicides <- tbl_df(read.csv(\"data-out/HomicidesMetroAreaDay.csv\", stringsAsFactors=FALSE))\nWeather <- tbl_df(read.csv(\"data-out/WeatherPanel.csv\",stringsAsFactors=FALSE))\nnames(Weather)[2] <- c(\"date_occur\")\nHomicides$date_occur <- substr(Homicides$date_occur,1,10)\nWeather$date_occur <- substr(Weather$date_occur,1,10)\nPanel <- merge(Homicides, Weather, by=c(1,2))\nremove(Weather, Homicides)\nPanel <- tbl_df(Panel)\n\n\n##Add some controls\nPanel$Year <- substr(Panel$date_occur, 1,4)\nPanel$Month <- substr(Panel$date_occur,6,7)\nPanel$date_occur <- ymd(Panel$date_occur)\nPanel$DayOfTheWeek <- wday(Panel$date_occur,label = TRUE,abbr = TRUE)\n\n\n#NA those non real values\nPanel$TMedia <- round(ifelse(Panel$TMedia>55 | Panel$TMedia<(-20),NA,Panel$TMedia),1)\nPanel$TMax <- round(ifelse(Panel$TMax>55 | Panel$TMax<(-20),NA,Panel$TMax),1)\nPanel$TMin <- round(ifelse(Panel$TMin>55 | Panel$TMin<(-20),NA,Panel$TMin),1)\n\n##Drop NA values \nPanel <- Panel[is.na(Panel$TMedia)==FALSE,]\nPanel <- Panel[is.na(Panel$TMax)==FALSE,]\nPanel <- Panel[is.na(Panel$TMin)==FALSE,]\n\n##Lag Days 1-5\nLag1 <- function(i){ #one Day\n  if(Panel[i-1,2] - Panel[i,2] == -1 & Panel[i-1,1] == Panel[i,1]){\n  tmp <- Panel[i-1,4]}\n  else{tmp <- NA}\n  return(tmp)\n}\nPanel$TMediaLag1 <- c(NA,sapply(2:nrow(Panel),Lag1))\nPanel$TMediaLag1 <- unlist(Panel$TMediaLag1)\nLag2 <- function(i){ #two Day\n  if(Panel[i-2,2] - Panel[i,2] == -2 & Panel[i-2,1] == Panel[i,1]){\n    tmp <- Panel[i-2,4]}\n  else{tmp <- NA}\n  return(tmp)\n}\nPanel$TMediaLag2 <- c(NA,NA,sapply(3:nrow(Panel),Lag2))\nPanel$TMediaLag2 <- unlist(Panel$TMediaLag2)\nLag3 <- function(i){ #two Day\n  if(Panel[i-3,2] - Panel[i,2] == -3 & Panel[i-3,1] == Panel[i,1]){\n    tmp <- Panel[i-3,4]}\n  else{tmp <- NA}\n  return(tmp)\n}\nPanel$TMediaLag3 <- c(NA,NA,NA,sapply(4:nrow(Panel),Lag3))\nPanel$TMediaLag3 <- unlist(Panel$TMediaLag3)\nLag4 <- function(i){ #two Day\n  if(Panel[i-4,2] - Panel[i,2] == -4 & Panel[i-4,1] == Panel[i,1]){\n    tmp <- Panel[i-4,4]}\n  else{tmp <- NA}\n  return(tmp)\n}\nPanel$TMediaLag4 <- c(NA,NA,NA,NA,sapply(5:nrow(Panel),Lag4))\nPanel$TMediaLag4 <- unlist(Panel$TMediaLag4)\nLag5 <- function(i){ #two Day\n  if(Panel[i-5,2] - Panel[i,2] == -5 & Panel[i-5,1] == Panel[i,1]){\n    tmp <- Panel[i-5,4]}\n  else{tmp <- NA}\n  return(tmp)\n}\nPanel$TMediaLag5 <- c(NA,NA,NA,NA,NA,sapply(6:nrow(Panel),Lag5))\nPanel$TMediaLag5 <- unlist(Panel$TMediaLag5)\nremove(list=ls(pattern=\"Lag\"))\n\n## Create controls for days over 25C and for continued days with more than that temp\nPanel$HighTempMean1Day <- ifelse(Panel$TMedia>=30,1,0)\nPanel$HighTempMax1Day <- ifelse(Panel$TMax>=30,1,0)\nPanel$HighTempMin1Day <- ifelse(Panel$TMin>=30,1,0)\nPanel$HighTempMean2Day <- ifelse(Panel$TMedia>=30 & Panel$TMediaLag1>=30,1,0)\nPanel$HighTempMean3Day <- ifelse(Panel$TMedia>=30 & Panel$TMediaLag1>=30 & Panel$TMediaLag2>=30,1,0)\nPanel$HighTempMean4Day <- ifelse(Panel$TMedia>=30 & Panel$TMediaLag1>=30 & Panel$TMediaLag2>=30 & Panel$TMediaLag3>=30,1,0)\nPanel$HighTempMean5Day <- ifelse(Panel$TMedia>=30 & Panel$TMediaLag1>=30 & Panel$TMediaLag2>=30 & Panel$TMediaLag3>=30 & Panel$TMediaLag4>=30,1,0)\nPanel$HighTempMean6Day <- ifelse(Panel$TMedia>=30 & Panel$TMediaLag1>=30 & Panel$TMediaLag2>=30 & Panel$TMediaLag3>=30 & Panel$TMediaLag4>=30 & Panel$TMediaLag5>=30,1,0)\n\n\n## Create controls for days over 30C and for continued days with more than that temp\nPanel$HighTempMean1Day25 <- ifelse(Panel$TMedia>=25,1,0)\nPanel$HighTempMax1Day25 <- ifelse(Panel$TMax>=25,1,0)\nPanel$HighTempMin1Day25 <- ifelse(Panel$TMin>=25,1,0)\nPanel$HighTempMean2Day25 <- ifelse(Panel$TMedia>=25 & Panel$TMediaLag1>=25,1,0)\nPanel$HighTempMean3Day25 <- ifelse(Panel$TMedia>=25 & Panel$TMediaLag1>=25 & Panel$TMediaLag2>=25,1,0)\nPanel$HighTempMean4Day25 <- ifelse(Panel$TMedia>=25 & Panel$TMediaLag1>=25 & Panel$TMediaLag2>=25 & Panel$TMediaLag3>=25,1,0)\nPanel$HighTempMean5Day25 <- ifelse(Panel$TMedia>=25 & Panel$TMediaLag1>=25 & Panel$TMediaLag2>=25 & Panel$TMediaLag3>=25 & Panel$TMediaLag4>=25,1,0)\nPanel$HighTempMean6Day25 <- ifelse(Panel$TMedia>=25 & Panel$TMediaLag1>=25 & Panel$TMediaLag2>=25 & Panel$TMediaLag3>=25 & Panel$TMediaLag4>=25 & Panel$TMediaLag5>=25,1,0)\n\n##Out\nwrite.csv(Panel, \"data-out/WeatherHomicidePanel.csv\", row.names=FALSE)\nremove(Panel)\n",
    "created" : 1420651465300.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2284970704",
    "id" : "1FF381D1",
    "lastKnownWriteTime" : 1420674572,
    "path" : "~/D4D/Homicidios-Temp/src/CreateFinalPanel.R",
    "project_path" : "src/CreateFinalPanel.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}